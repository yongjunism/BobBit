{% extends 'base/base.html' %}
{% load static %}
{% block head %}
<link href="{% static 'css/pricePredict/price.css' %}" rel="stylesheet">
<link href="{% static 'css/pricePredict/bootstrap-datepicker.css' %}" rel="stylesheet">
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
{% endblock head %}

{% block contents %}
    <div class ="p_Container">
        <div class = "catagori-Nav">
        {% for pd in pd_list %}
        <li class="page-item">
            {% if pd.pNo ==  product_info.pNo %}
            <a class="select" href='../{{ pd.pNo }}'>
                {{ pd.pName }}
            </a>
            {% else %}
            <a class="non-select" href='../{{ pd.pNo }}'>
                {{ pd.pName }}
            </a>
            {% endif %}
        </li>
        {% endfor %}
        </div>
        <section class = "title_section">
            <h1>{{icon}} {{product_info.pName}}</h1>
            <li> ëŒ€í˜•ë§ˆíŠ¸ "ì›ê°€" ê¸°ì¤€</li>
        </section>
        <div class= "line"></div>
        <div id = "content-area">
            <div id = "content_1">
                <div class = "datearea">
                    <li>ë‚ ì§œë¥¼ ì„ íƒí•´ ì›í•˜ëŠ” ì°¨íŠ¸ë¥¼ ì´ë™í•´ë³´ì„¸ìš”ğŸ‘‰</li>
                    <div class = "datepicker">
                        <input type="text" id="datePicker" value={{today.year}}-{{today.month}}-{{today.day}}>
                    </div>
                </div>
                <section class ="chartarea">
                    <div id="chartdiv"></div>
                </section>
            </div>
            <div id = "content_2">
                <div class="predict">
                    <span class = "pre_div" id = "p_Name">{{product_info.pName}}</span>
                    <span class = "pre_div">
                        <h1 id ="p_Month">{{lastmonth}}</h1>
                        <p>ì›” ëŒ€ë¹„</p>
                        {% if next_price > now_price %}
                        <div id = "up_Box">
                            <span>
                            <p class = "icon">â–¼&nbsp&nbsp&nbsp</p>
                            <h1>
                                <script>
                                document.write(Math.abs(Math.round({{next_price}}-{{now_price}})));
                                </script>
                            </h1>
                            <p>ì›</p>
                            </span>
                            <span>
                                <p class = "icon">â–²&nbsp&nbsp&nbsp</p>
                                <h1>
                                    <script>
                                    document.write(Math.abs(Math.round(({{next_price}}-{{now_price}}) / {{now_price}} * 100 * 100) /100));
                                    </script>
                                </h1>
                                <p>%</p>
                            </span>
                        </div>
                        {% else %}
                        <div id = "down_Box">
                            <span>
                            <p class = "icon">â–¼&nbsp&nbsp&nbsp</p>
                            <h1>
                                <script>
                                document.write(Math.abs(Math.round({{next_price}}-{{now_price}})));
                                </script>
                            </h1>
                            <p>ì›</p>
                            </span>
                            <span>
                                <p class = "icon">â–¼&nbsp&nbsp&nbsp</p>
                                <h1>
                                    <script>
                                    document.write(Math.abs(Math.round(({{next_price}}-{{now_price}}) / {{now_price}} * 100 * 100) /100));
                                    </script>
                                </h1>
                                <p>%</p>
                            </span>
                        </div>
                        {% endif %}
                        <p>ì˜ˆìƒë©ë‹ˆë‹¤</p>
                    </span >
                    <span class = "pre_div">
                        <form name="form1">
                              <ul id="info">
                                <li>
                                  <div class = "box" id = "now_price">
                                    <label for="price"> í˜„ì¬ ê°€ê²©(1ê°œ)</label>
                                    <div>
                                    <input type="text" name="price" value={{product_info.price}} style="width:100px; height:30px" readonly>ì›
                                    </div>
                                  </div>
                                </li>
                                <li>
                                    <div class = "box" id = "quantity_box">
                                      <label for="quantity">ìˆ˜ëŸ‰</label>
                                      <div class = "button-box">
                                      <input id = "text" type="text" name="quantity" value="1" max="" style="width:100px; height:30px">
                                      <input id = "button" type="button" value=" + " name="add">
                                      <input id = "button" type="button" value=" - " name="minus">
                                      </div>
                                    </div>
                                </li>
                                <li>
                                    <div class = "box" id = "buy_box" onclick="alert('êµ¬ë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')">
                                        <label for="total">êµ¬ë§¤</label>
                                        <div class = "button-box">
                                        <input id = "text" type="text" name="total" value={{totalVal}} style="width:100px; height:30px" readonly>p
                                        </div>
                                      </div>
                                </li>
                              </ul>
                        
                            {% comment %} <div>
                              {% if request.session %}
                                <input type="submit" class="purchase" value="êµ¬ë§¤" onclick="alert('êµ¬ë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')">
                              {% else %}
                                <input type="button" class="login" value="êµ¬ë§¤" onclick="windows.open('../../accounts/login')">
                              {% endif %}
                            </div> {% endcomment %}
                          </form>
                    </span>
                </div>
            </div>
        </div>
        <div class= "line"></div>
        <div id="recommend-area">
          <h2> êµ¬ë§¤ì¶”ì²œ</h2>
          <h6 class = "sub-title"> í•´ë‹¹ ê°€ê²©ì€ coupang ë­í‚¹ ê¸°ì¤€ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</h6>
          <div class="others" style="padding-left:50px">
              {% for pd in pd_list %}
              <div id = "product_row">
                {% if pd.pNo != product_info.pNo %}
                  <p class = "name">{{pd.pName}}</p>
                  <p><u>ë°°ì†¡ë¹„ í¬í•¨</u></p>
                  <p class = "price">{{pd.price}}ì›</p>
                  <input class = "button" type="button" value="êµ¬ë§¤í•˜ëŸ¬ ê°€ê¸°" onclick="window.open('../{{ pd.pNo }}')"><br>
                {% endif %}
              {% endfor %}
              </div>
          </div>
        </div>
    </div>
{% endblock contents %}

{% block script_section %}
<script>
    let xss_str = "{{pd_data}}";
    xss_str = xss_str.replace(/&quot;/g,'"');
    let price_data = JSON.parse(xss_str)
    let next_price = Math.round({{next_price}})
    let next_date = "{{today.year}}-{{today.month}}-01"
</script>
<script src="{% static 'js/pricePredict/amcharts.js'%}"></script>
<script src="{% static 'js/pricePredict/bootstrap-datepicker.js'%}"></script>
<script>
    const csrftoken = getCookie('csrftoken');
	$(function() {
		$('#datePicker').datepicker({
		    format: "yyyy-mm-dd",	//ë°ì´í„° í¬ë§· í˜•ì‹(yyyy : ë…„ mm : ì›” dd : ì¼ )
		    autoclose : true,	//ì‚¬ìš©ìê°€ ë‚ ì§œë¥¼ í´ë¦­í•˜ë©´ ìë™ ìº˜ë¦°ë”ê°€ ë‹«íˆëŠ” ì˜µì…˜
		    clearBtn : true, //ë‚ ì§œ ì„ íƒí•œ ê°’ ì´ˆê¸°í™” í•´ì£¼ëŠ” ë²„íŠ¼ ë³´ì—¬ì£¼ëŠ” ì˜µì…˜ ê¸°ë³¸ê°’ false ë³´ì—¬ì£¼ë ¤ë©´ true
		    showWeekDays : true ,// ìœ„ì— ìš”ì¼ ë³´ì—¬ì£¼ëŠ” ì˜µì…˜ ê¸°ë³¸ê°’ : true
		    title: "ë‚ ì§œ ì„ íƒ",	//ìº˜ë¦°ë” ìƒë‹¨ì— ë³´ì—¬ì£¼ëŠ” íƒ€ì´í‹€
		    todayHighlight : true ,	//ì˜¤ëŠ˜ ë‚ ì§œì— í•˜ì´ë¼ì´íŒ… ê¸°ëŠ¥ ê¸°ë³¸ê°’ :false 
		    language : "ko"	//ë‹¬ë ¥ì˜ ì–¸ì–´ ì„ íƒ, ê·¸ì— ë§ëŠ” jsë¡œ êµì²´í•´ì¤˜ì•¼í•œë‹¤.
		}).on("changeDate", function(e){

        })
	})
</script>
<script type="text/javascript">
  const formform = document.getElementsByName("form1"),
        price = document.form1.price,
        quantity = document.form1.quantity,
        add = document.form1.add,
        minus = document.form1.minus,
        total = document.form1.total;
    
  if (formform){
    total.value = price.value;

    let quantityVal = quantity.value,
        totalVal = total.value,
        priceVal = price.value;

    if(add){
      add.addEventListener('click', function(){
        quantityVal++;
        totalVal = quantityVal * priceVal;
        quantity.value = quantityVal;
        total.value = totalVal;
        console.log(quantityVal, totalVal, priceVal);
      })
    }
      
    if(minus){
      minus.addEventListener('click', function(){
        if (quantityVal >= 1){
          quantityVal--;
          totalVal = quantityVal * priceVal;
          quantity.value = quantityVal;
          total.value = totalVal;
          console.log(quantityVal, totalVal, priceVal);
      }else{
        quantityVal = 1;
        }
      })
    }
  }
</script>
{% endblock script_section %}